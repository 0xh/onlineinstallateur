{loop type="auth" name="can_view" role="ADMIN" resource="admin.order" access="VIEW"}

{$page={$smarty.get.page|default:1}}
{$product_order={$smarty.get.product_order|default:'id'}}
{$brand_filter={$smarty.get.brand|default:''}}
{$platform_filter={$smarty.get.platform|default:''}}
{$position_sorting={$smarty.get.position|default:'asc'}}
{$search_term={$smarty.get.search_term|default:''}}

<div class="general-block-decorator dashboard">
    <div class="title title-without-tabs clearfix">
        {intl l='Dashboard Crawler' d='hookadmincrawlerdashboard.bo.default'}
    </div>
    <section class="clearfix">
        {ifloop rel="brand-filter"}
            <div class="block block-nav col-md-2 col-lg-2 col-xlg-2 col-sm-6 col-xs-12 text-left" role="navigation" aria-labelledby="search-label">
                <h5  id="search-label">{intl l="Brand" d="criteriasearch.fo.default"}</h5>
                <select class="filter filter_brand">
                    <option value="">{intl l="All brands"}</option>
                    {loop type="search_brand" name="brand-filter"}
                        <option value="{$ID}" {if $brand_filter|strstr:"$ID"}selected{/if}>{$TITLE}</option>
                    {/loop}
                </select>
            </div>
        {/ifloop}
        
        <div class="block block-nav col-md-2 col-lg-2 col-xlg-2 col-sm-6 col-xs-12  text-left" role="navigation" aria-labelledby="search-label">
            <h5  id="search-label">{intl l="Platform" d="criteriasearch.fo.default"}</h5>
            <select class="filter filter_platform">
                <option value="">{intl l="All platforms"}</option>
                <option value="Google" {if $platform_filter|strstr:"Google"}selected{/if}>GOOGLE SHOPPING</option>
                <option value="Geizhals" {if $platform_filter|strstr:"Geizhals"}selected{/if}>GEIZHALS</option>
                <option value="Amazon" {if $platform_filter|strstr:"Amazon"}selected{/if}>AMAZON</option>
                <option value="Reuter" {if $platform_filter|strstr:"Reuter"}selected{/if}>REUTER</option>
                <option value="Megabad" {if $platform_filter|strstr:"Megabad"}selected{/if}>MEGABAD</option>
                <option value="Skybad" {if $platform_filter|strstr:"Skybad"}selected{/if}>SKYBAD</option>
            </select>
        </div>
        {assign var="position_sorting" value="asc" nocache}

        <div class="sidebar-search col-md-6 col-xlg-6 col-sm-12 co-xs-12">
            <h5  id="search-label">{intl l="Search" d="criteriasearch.fo.default"}</h5>
            <form action="{url path='/admin/module/HookAdminCrawlerDashboard'}">                                        
                <div class="input-group">
                    <input type="text" class="form-control" id="search_term" name="search_term" placeholder="{intl l='Search'}" value="{trim($smarty.get.search_term)}">
                    <span class="input-group-btn">
                        <button type="submit" class="btn btn-default"><span class="glyphicon glyphicon-search"></span></button>
                    </span>
                </div>
            </form>
        </div>
    </section>
    <br>

  {capture assign=defaultCurrency}
    {loop type="currency" name="default-currency" default_only="1"}
    {$SYMBOL}
    {/loop}
  {/capture}  

    <div class="crawlerdebug">
        {$PRODUCT_SALE_ELEMENT}
    </div>
        <div class="table-responsive">
            <table class="table table-condensed">
                <thead> 
                    <tr class="platform-logos">
                        <td> {admin_sortable_header
                              current_order=$product_order
                              order='id'
                              reverse_order='id_reverse'
                              path={url path='admin/module/HookAdminCrawlerDashboard' product_order=$product_order}
                              request_parameter_name='product_order'
                              label="{intl l='ID'}"
                              }
                        </td>
                        <td>Bild</td>
                        <td>Produkt</td>
                        <td>EK</td>
                        <td></td>
                        <td><img src="{image file='assets/img/logos/hausfabrik.png'}" alt="HAUSFABRIK" class="platform-logos" /></td>
                        <td><img src="{image file='assets/img/logos/google.png'}" alt="GOOGLE SHOPPING" class="platform-logos" /></td>
                        <td><img src="{image file='assets/img/logos/geizhals.png'}"  alt="GEIZHALS" class="platform-logos" /></td>
                        <td><img src="{image file='assets/img/logos/amazon.png'}" alt="AMAZON" class="platform-logos" /></td>
                        <td><img src="{image file='assets/img/logos/reuter.png'}" alt="REUTER" class="platform-logos" /></td>
                        <td><img src="{image file='assets/img/logos/megabad.png'}" alt="MEGABAD" class="platform-logos" /></td>
                        <td><img src="{image file='assets/img/logos/skybad.png'}" alt="SKYBAD" class="platform-logos" /></td>
                    </tr> 
                </thead> 
                <tbody>  
                {loop name="product_position_list" type="crawler_product" position=$position_sorting search_mode="sentence" search_term=$search_term search_in="ean_code,ref,title,id" platform=$platform_filter visible="*" brand=$brand_filter has_ean="1" order=$product_order page=$page  limit={config key="number_default_results_per_page.category_list" default=10} return_url=false}
                    <tr>
                        <td>{$ID}</td>
                        <td>
                            {loop type="image" name="cat_image" source="product" source_id="$ID" limit="1" width="50" height="50" resize_mode="crop" backend_context="1"}
                               <a href="{url path='/admin/products/update' product_id=$OBJECT_ID page=$page}" title="{intl l='Edit this product'}">
                                 <img src="{$IMAGE_URL nofilter}" alt="{$TITLE}" />
                               </a>
                            {/loop}
                        </td>
                        <td class="object-title">
                            <a href="{url path='/admin/products/update' product_id=$ID page=$page}" title="{intl l='Edit this product'}">{$REF}</a>
                        </td>

                        <td>
                            <table class="crawler-product table-responsive">
                            <tr>
                                <td>GC {$EK_PREIS_GC}</td>
                            </tr>
                            <tr>
                                <td>SHT {$EK_PREIS_SHT}</td>                        
                            </tr>
                            <tr>
                                <td>Ã–AG {$EK_PREIS_OAG}</td>
                            </tr>
                         </table>
                        </td>
                        <td >Erster Preis</td>
                        <td class="text-center">
                            <a href="{url path='/admin/products/update' product_id=$ID page=$page current_tab='prices'}" title="{intl l='Edit Prices On'} Hausfabrik">{format_money number=$BEST_TAXED_PRICE symbol=$currency_symbol}</a>
                        </td>
                        {loop name="crawler_product_listing" type="crawler_listing" product_base_id=$CRAWLER_ID}
                            {if $PLATFORM != 'Idealo'}
                                <td class="product_listing  text-center">
                                    {if $FIRST_PRICE == -1}
                                        Not Available
                                    {else}
                                        {format_money number=$FIRST_PRICE symbol=$currency_symbol}
                                    {/if}
                                </td>
                            {/if}
                        {/loop}
                     </tr>     
                {/loop}
                </tbody>
            </table>
         </div>
        <tfoot>
             <tr>
                 <td colspan="100">
                     {include
                     file = "includes/pagination.html"
                     loop_ref       = "product_position_list"
                     max_page_count = 10
                     page_url       = {url path="/admin/module/HookAdminCrawlerDashboard" product_order=$product_order brand=$brand_filter position=$position_sorting platform=$platform_filter search_term=$search_term}
                     }
                 </td>
             </tr>
        </tfoot>
 </div>
{/loop}

{capture name='_smarty_debug' assign=debug_output}
    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
    <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>Smarty Debug Console</title>
        <style type="text/css">
            {literal}
            body, h1, h2, td, th, p {
                font-family: sans-serif;
                font-weight: normal;
                font-size: 0.9em;
                margin: 1px;
                padding: 0;
            }

            h1 {
                margin: 0;
                text-align: left;
                padding: 2px;
                background-color: #f0c040;
                color: black;
                font-weight: bold;
                font-size: 1.2em;
            }

            h2 {
                background-color: #9B410E;
                color: white;
                text-align: left;
                font-weight: bold;
                padding: 2px;
                border-top: 1px solid black;
            }

            body {
                background: black;
            }

            p, table, div {
                background: #f0ead8;
            }

            p {
                margin: 0;
                font-style: italic;
                text-align: center;
            }

            table {
                width: 100%;
            }

            th, td {
                font-family: monospace;
                vertical-align: top;
                text-align: left;
                width: 50%;
            }

            td {
                color: green;
            }

            .odd {
                background-color: #eeeeee;
            }

            .even {
                background-color: #fafafa;
            }

            .exectime {
                font-size: 0.8em;
                font-style: italic;
            }

            #table_assigned_vars th {
                color: blue;
            }

            #table_config_vars th {
                color: maroon;
            }

            {/literal}
        </style>
    </head>
    <body>

    <h1>Smarty Debug Console
        -  {if isset($template_name)}{$template_name|debug_print_var nofilter}{else}Total Time {$execution_time|string_format:"%.5f"}{/if}</h1>

    {if !empty($template_data)}
        <h2>included templates &amp; config files (load time in seconds)</h2>
        <div>
            {foreach $template_data as $template}
                <font color=brown>{$template.name}</font>
                <span class="exectime">
   (compile {$template['compile_time']|string_format:"%.5f"}) (render {$template['render_time']|string_format:"%.5f"}) (cache {$template['cache_time']|string_format:"%.5f"}
                    )
  </span>
                <br>
            {/foreach}
        </div>
    {/if}

    <h2>assigned template variables</h2>

    <table id="table_assigned_vars">
        {foreach $assigned_vars as $vars}
            <tr class="{if $vars@iteration % 2 eq 0}odd{else}even{/if}">
                <th>${$vars@key|escape:'html'}</th>
                <td>{$vars|debug_print_var nofilter}</td>
            </tr>
        {/foreach}
    </table>

    <h2>assigned config file variables (outer template scope)</h2>

    <table id="table_config_vars">
        {foreach $config_vars as $vars}
            <tr class="{if $vars@iteration % 2 eq 0}odd{else}even{/if}">
                <th>{$vars@key|escape:'html'}</th>
                <td>{$vars|debug_print_var nofilter}</td>
            </tr>
        {/foreach}

    </table>
    </body>
    </html>
{/capture}
<script type="text/javascript">
    {$id = $template_name|default:''|md5}
    _smarty_console = window.open("", "console{$id}", "width=680,height=600,resizable,scrollbars=yes");
    _smarty_console.document.write("{$debug_output|escape:'javascript' nofilter}");
    _smarty_console.document.close();
</script>

{debug}