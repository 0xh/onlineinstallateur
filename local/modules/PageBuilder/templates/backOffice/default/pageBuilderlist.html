{extends file="admin-layout.tpl"}

{block name="no-return-functions"}
    {$admin_current_location = 'tools'}
{/block}

{block name="check-resource"}admin.page_builder{/block}
{block name="check-access"}view{/block}

{block name="page-title"}{intl l='PageBuilder List'}{/block}

{block name="main-content"}
    <div class="container" id="wrapper">
        <ul class="breadcrumb">
            <li><a href="{url path='/admin/home'}">{intl l="Home"}</a></li>
            <li><a href="{url path='/admin/tools'}">{intl l="Tools"}</a></li>
            <li><a href="{url path='/admin/PageBuilder'}">{intl l="PageBuilder"}</a></li>
        </ul>
        {if $message != ""}
            <div class="row">
                <div class="alert-block">
                    <div class="col-md-12">
                        <div class="alert alert-warning" role="alert">
                            {$message}
                        </div>
                    </div>
                </div>
            </div>
        {/if}
        <div class="row">
            <div class="col-md-12">
                <div class="general-block-decorator">
                    <div class="table-responsive">
                        <table class="table table-striped table-condensed">
                            <caption class="clearfix">
                                {intl l='PageBuilder'}
                                {loop type="auth" name="can_create" role="ADMIN" resource="admin.page_builder" access="CREATE"}
                                    <span class="pull-right">
                                        <a class="btn btn-primary btn-create-selection" id="showModalCreatePageBuilder" title="{intl l='Add a new PageBuilder'}" href="#creation_dialog" data-toggle="modal">
                                            <span class="glyphicon glyphicon-plus-sign"></span>
                                        </a>
                                    </span>
                                {/loop}
                                <thead>
                                <tr>
                                    <th class="text-center">{intl l='ID'}</th>
                                    <th></th>
                                    <th>{intl l="Title"}</th>
                                    <th class="text-center">{intl l="Position"}</th>
                                    <th class="text-center">{intl l='Online'}</th>
                                    <th class="actions text-center">{intl l='Actions'}</th>
                                </tr>
                                </thead>
                                {loop name="pageBuilder" type="page_builder_list" visible="*" backend_context="1" lang=$lang_id order=$order}
                                    <tbody>
                                    <tr>
                                        <td class="text-center">{$PAGE_BUILDER_ID}</td>
                                        <td>
                                            {loop type="page_builder_image" name="page_builder_image" lang="$edit_language_id" source="pageBuilder" source_id=$PAGE_BUILDER_ID width="70" height="50" resize_mode="borders" limit="1" visible="true"}
                                                <img class="img-thumbnail" src="{$IMAGE_URL nofilter}" href="{url path="admin/page-builder/update/%pageBuilderId" pageBuilderId=$PAGE_BUILDER_ID}">
                                            {/loop}
                                        </td>
                                        <td>
                                            {loop type="auth" name="can_change" role="ADMIN" resource="admin.page_builder"}
                                                <a title="{intl l='Change this page builder'}" href="{url path="admin/page-builder/update/%pageBuilderId" pageBuilderId=$PAGE_BUILDER_ID}">{$PAGE_BUILDER_TITLE}</a>
                                            {/loop}
                                            {elseloop rel="can_change"}
                                            {$PAGE_BUILDER_TITLE}
                                            {/elseloop}
                                        </td>
                                        <td class="text-center">
                                            {$PAGE_BUILDER_POSITION}
                                        </td>
                                        <td class="text-center">
                                            {loop type="auth" name="can_change" role="ADMIN" resource="admin.page_builder" access="UPDATE"}
                                                <div class="make-switch switch-small selectionVisibleToggle" data-id="{$PAGE_BUILDER_ID}"  data-on="success" data-off="danger" data-on-label="<i class='glyphicon glyphicon-ok'></i>" data-off-label="<i class='glyphicon glyphicon-remove'></i>">
                                                    <input type="checkbox" class="selectionVisibleToggle" {if $PAGE_BUILDER_VISIBLE == 1}checked="checked"{/if}>
                                                </div>
                                            {/loop}
                                            {elseloop rel="can_change"}
                                                <div class="make-switch switch-small" data-on="success" data-off="danger" data-on-label="<i class='glyphicon glyphicon-ok'></i>" data-off-label="<i class='glyphicon glyphicon-remove'></i>">
                                                    <input type="checkbox" class="disabled" disabled="disabled" {if $PAGE_BUILDER_VISIBLE == 1}checked="checked"{/if}>
                                                </div>
                                            {/elseloop}
                                        </td>

                                        <td class="actions text-center">
                                            <div class="btn-toolbar btn toolbar-primary">
                                                <span class="glyphicon glyphicon-cog"></span>
                                            </div>
                                            <div class="toolbar-options hidden">
                                                {loop type="auth" name="can_change" role="ADMIN" resource="admin.page_builder"}
                                                    <a class="selection-change" title="{intl l='Change this page builder'}" href="{url path="admin/page-builder/update/%pageBuilderId" pageBuilderId=$PAGE_BUILDER_ID}">
                                                        <span class="glyphicon glyphicon-edit"></span>
                                                    </a>
                                                {/loop}

                                                {loop type="auth" name="can_delete" role="ADMIN" resource="admin.page_builder" access="DELETE"}
                                                    <a class="selection-delete" title="{intl l='Delete this page builder'}" href="{url path="admin/page-builder/delete/%pageBuilderId" pageBuilderId=$PAGE_BUILDER_ID}">
                                                        <span class="glyphicon glyphicon-trash"></span>
                                                    </a>
                                                {/loop}
                                            </div>
                                        </td>
                                    </tr>
                                    </tbody>
                                {/loop}
                            </caption>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" tabindex="-1" id="modalCreate" role="dialog" aria-hidden="true">
        {form name="admin.page_builder.create"}
            <form method="post" action="{url path='admin/page-builder/create'}">
                {form_hidden_fields form=$form}
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>{intl l='Create a PageBuilder'}</h3>
                        </div>
                        <div class="modal-body align-center">
                            <div class="js-form-create">
                                <div class="row">
                                    <div class="col-md-10 col-md-offset-1">
                                        {form_field form=$form field='page_builder_title'}
                                            <div class="form-group">
                                                <label for="{$label_attr.for}" class="control-label">{intl l='PageBuilder title'}</label>
                                                <div class="control-input">
                                                    <input type="text" id="{$label_attr.for}" name="{$name}" value="{$title}" class="form-control" aria-required="true" required>
                                                </div>
                                            </div>
                                        {/form_field}

                                        {form_field form=$form field='page_builder_chapo'}
                                            <div class="form-group">
                                                <label for="{$label_attr.for}" class="control-label">{intl l='Summary'}</label>
                                                <div class="control-input">
                                                    <textarea name="{$name}" id="{$label_attr.for}" class="form-control" rows="3">{$summary}</textarea>
                                                </div>
                                            </div>
                                        {/form_field}

                                        {form_field form=$form field='page_builder_header'}
                                            <div class="form-group">
                                                <label for="{$label_attr.for}" class="control-label">{intl l='Header'}</label>
                                                <div class="control-input">
                                                    <textarea name="{$name}" id="{$label_attr.for}" class="form-control wysiwyg" rows="3">{$header}</textarea>
                                                </div>
                                            </div>
                                        {/form_field}

                                        {form_field form=$form field='page_builder_footer'}
                                            <div class="form-group">
                                                <label for="{$label_attr.for}" class="control-label">{intl l='Footer'}</label>
                                                <div class="control-input">
                                                    <textarea name="{$name}" id="{$label_attr.for}" class="form-control wysiwyg" rows="3">{$footer}</textarea>
                                                </div>
                                            </div>
                                        {/form_field}

                                        {form_field form=$form field='page_builder_postscriptum'}
                                            <div class="form-group">

                                                <label for="{$label_attr.for}" class="control-label"> {intl l='Conclusion'}</label>

                                                <div class="control-input">
                                                    <textarea name="{$name}" id="{$label_attr.for}" value="{$conclusion}" class="form-control" rows="3">{$conclusion}</textarea>
                                                </div>
                                            </div>
                                        {/form_field}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <a href="#" class="js-btn-dismiss-modal btn btn-default" data-dismiss="modal">{intl l="Close"}</a>
                            <button type="submit" class="js-modal-btn-save btn btn-success">{intl l="Save"}</button>
                        </div>

                    </div>
                </div>
            </form>
        {/form}
    </div>

{/block}

{block name="javascript-last-call"}
    {hook name="wysiwyg.js"}

    {javascripts file='assets/js/bootstrap-switch/bootstrap-switch.js'}
        <script src="{$asset_url}"></script>
    {/javascripts}

    {javascripts file='assets/js/jquery-ui-1.10.3.custom.min.js'}
        <script src="{$asset_url}"></script>
    {/javascripts}

    <script>
        $(function () {
            $('#showModalCreatePageBuilder').on('click',function (event) {
                $("#modalCreate").modal("show");


                if (("#modalCreate").modal("show")) {
                    $('.js-btn-dismiss-modal').on('click', function () {
                        $('#modalCreate').dismiss();
                    })
                }
            });

            $(".selectionVisibleToggle").on('switch-change', function(event, data) {
                $.ajax({
                    url : "{url path='admin/page-builder/toggle-online'}",
                    data : {
                        pageBuilderId : $(this).data('id'),
                        action : 'visibilityToggle'
                    }
                });
            });

        });

    </script>
{/block}